# 다음 작업 가이드

이 문서는 다음에 작업을 재개할 때 참고할 가이드입니다.

---

## 🔄 작업 재개 방법

### 1. 프로젝트 복원
```bash
# 압축 파일 압축 해제
unzip construction-equipment-management.zip

# 프로젝트 디렉토리로 이동
cd construction-equipment-management

# 의존성 설치
pnpm install

# 데이터베이스 마이그레이션 (DATABASE_URL 설정 후)
pnpm db:push

# 개발 서버 실행
pnpm dev
```

### 2. 환경 변수 설정
`.env` 파일을 생성하고 다음 변수를 설정하세요:
```
DATABASE_URL=mysql://user:password@host:port/database
JWT_SECRET=your-secret-key
VITE_APP_ID=your-app-id
OAUTH_SERVER_URL=https://api.manus.im
VITE_OAUTH_PORTAL_URL=https://portal.manus.im
```

### 3. 현재 상태 확인
- 최신 버전: `c78239ba`
- 브랜치: `main`
- 마지막 체크포인트: 안전점검표 템플릿 시스템 완성

---

## 📋 우선순위별 작업 목록

### 🔴 우선순위 1: 이메일 알림 시스템

#### 목표
승인 요청, 승인 완료, 서류 만료 예정 시 자동 이메일 발송

#### 작업 단계
1. **알림 함수 확인**
   ```typescript
   // server/_core/notification.ts 확인
   import { notifyOwner } from "./server/_core/notification";
   ```

2. **반입 요청 승인 시 알림**
   - `server/routers.ts`의 `entryRequests.ownerApprove` 수정
   - 승인 완료 후 `notifyOwner` 호출
   ```typescript
   await notifyOwner({
     title: "반입 요청 승인 완료",
     content: `요청번호 ${req.requestNumber}가 승인되었습니다.`
   });
   ```

3. **서류 만료 예정 알림 스케줄러**
   - `server/scheduler.ts` 파일 생성
   - 매일 오전 9시에 만료 예정 서류 체크
   - 30일 이내 만료 예정 서류 목록 이메일 발송

4. **이메일 템플릿 작성**
   - HTML 이메일 템플릿 생성
   - 승인 요청, 승인 완료, 만료 예정 등 유형별 템플릿

#### 예상 소요 시간: 4-6시간

---

### 🟠 우선순위 2: 역할별 대시보드 커스터마이징

#### 목표
사용자 역할에 따라 다른 대시보드 위젯 표시

#### 작업 단계
1. **역할별 위젯 컴포넌트 생성**
   ```
   client/src/components/dashboard/
   ├── AdminDashboard.tsx
   ├── OwnerDashboard.tsx
   ├── BpDashboard.tsx
   ├── EpDashboard.tsx
   ├── WorkerDashboard.tsx
   └── InspectorDashboard.tsx
   ```

2. **Home.tsx 수정**
   ```typescript
   // client/src/pages/Home.tsx
   const { user } = useAuth();
   
   switch (user?.role) {
     case "admin":
       return <AdminDashboard />;
     case "owner":
       return <OwnerDashboard />;
     case "bp":
       return <BpDashboard />;
     case "ep":
       return <EpDashboard />;
     case "worker":
       return <WorkerDashboard />;
     case "inspector":
       return <InspectorDashboard />;
     default:
       return <DefaultDashboard />;
   }
   ```

3. **역할별 통계 API 추가**
   - `server/routers.ts`에 역할별 통계 엔드포인트 추가
   - 예: `dashboard.adminStats`, `dashboard.ownerStats` 등

#### 예상 소요 시간: 6-8시간

---

### 🟡 우선순위 3: 통계 및 리포트 기능

#### 목표
월별/분기별 통계 및 Excel/PDF 리포트 생성

#### 작업 단계
1. **차트 라이브러리 설치**
   ```bash
   pnpm add recharts
   ```

2. **통계 API 구현**
   - 장비 가동률 API
   - 인력 투입 현황 API
   - 서류 만료 통계 API
   - 안전점검 합격률 API

3. **통계 페이지 생성**
   ```
   client/src/pages/Statistics.tsx
   ```

4. **리포트 생성 기능**
   - Excel 다운로드: `xlsx` 라이브러리 사용
   - PDF 다운로드: `jsPDF` 라이브러리 사용

#### 예상 소요 시간: 8-10시간

---

### 🟢 우선순위 4: 모바일 최적화

#### 목표
모바일 사용성 개선

#### 작업 단계
1. **모바일 네비게이션 개선**
   - 하단 탭 네비게이션 추가
   - 햄버거 메뉴 개선

2. **터치 제스처 지원**
   - 스와이프로 메뉴 열기/닫기
   - 풀 투 리프레시

3. **카메라 연동**
   - 서류 촬영 기능
   - 이미지 자동 회전 및 크롭

4. **오프라인 모드**
   - Service Worker 추가
   - 오프라인 데이터 캐싱

#### 예상 소요 시간: 10-12시간

---

## 🛠️ 추가 개선 사항

### 1. 타입 안전성 개선
- `ChecklistForms.tsx`의 타입 경고 해결
- 전역 타입 정의 파일 생성 (`types/index.ts`)

### 2. 에러 처리 개선
- 전역 에러 바운더리 강화
- API 에러 메시지 표준화

### 3. 성능 최적화
- React Query 캐싱 전략 개선
- 이미지 lazy loading
- 코드 스플리팅

### 4. 테스트 코드 작성
- 단위 테스트 (Vitest)
- E2E 테스트 (Playwright)

### 5. 문서화
- API 문서 자동 생성
- 컴포넌트 Storybook 추가

---

## 📚 참고 자료

### 프로젝트 문서
- `작업진행상황.md` - 현재까지 완료된 작업 목록
- `README.md` - 프로젝트 개요 및 실행 방법
- `DEPLOYMENT.md` - 배포 가이드

### 주요 파일
- `drizzle/schema.ts` - 데이터베이스 스키마
- `server/routers.ts` - 백엔드 API
- `client/src/App.tsx` - 프론트엔드 라우팅
- `client/src/components/DashboardLayout.tsx` - 레이아웃

### 외부 문서
- [tRPC 공식 문서](https://trpc.io/)
- [Drizzle ORM 공식 문서](https://orm.drizzle.team/)
- [shadcn/ui 공식 문서](https://ui.shadcn.com/)
- [Tailwind CSS 공식 문서](https://tailwindcss.com/)

---

## 💡 팁

### 1. 빠른 테스트
```bash
# 특정 페이지만 테스트하고 싶을 때
# 브라우저에서 직접 URL 입력
http://localhost:3000/equipment
http://localhost:3000/entry-requests
```

### 2. 데이터베이스 초기화
```bash
# 데이터베이스를 처음부터 다시 시작하고 싶을 때
pnpm db:push
```

### 3. 타입 체크
```bash
# TypeScript 타입 오류 확인
pnpm tsc --noEmit
```

### 4. 코드 포맷팅
```bash
# Prettier로 코드 포맷팅 (설치 필요)
pnpm prettier --write "**/*.{ts,tsx,js,jsx,json,css,md}"
```

---

## 🚨 주의사항

1. **환경 변수 관리**
   - `.env` 파일을 절대 커밋하지 마세요
   - 프로덕션 환경 변수는 별도로 관리

2. **데이터베이스 마이그레이션**
   - 스키마 변경 시 반드시 `pnpm db:push` 실행
   - 프로덕션 배포 전 백업 필수

3. **파일 업로드**
   - S3 설정 확인 필수
   - 파일 크기 제한 설정 권장

4. **보안**
   - JWT_SECRET은 강력한 랜덤 문자열 사용
   - API 엔드포인트에 적절한 권한 체크

---

## 📞 도움이 필요할 때

1. **에러 발생 시**
   - 콘솔 로그 확인
   - 브라우저 개발자 도구 Network 탭 확인
   - 서버 로그 확인

2. **기능 추가 시**
   - 기존 코드 패턴 참고
   - 타입 안전성 유지
   - 에러 처리 추가

3. **배포 문제 시**
   - `DEPLOYMENT.md` 참고
   - 환경 변수 확인
   - 빌드 로그 확인

---

**작성일**: 2024-11-07  
**다음 업데이트 예정**: 이메일 알림 시스템 완성 후
