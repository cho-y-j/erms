# 건설장비 및 인력관리 시스템(ERMS) - 실제 요구사항 정리

**작성일**: 2025-10-26  
**작성자**: 실제 사용자 요구사항 기반

---

## 🚨 현재 시스템의 심각한 문제점

### 1. 로그인 시스템 문제
- ❌ 비밀번호를 묻지 않고 자동 로그인됨
- ❌ 로그아웃 기능이 작동하지 않음
- ❌ 역할별 로그인 테스트 불가능

### 2. 반입 요청 검증 실패
- ❌ 반입 요청 시 검증이 통과되지 않아 등록 불가

### 3. 역할별 대시보드 미최적화
- ❌ 각 역할(Admin, Owner, BP, EP)별 맞춤 대시보드 없음
- ❌ 필요한 정보가 역할에 맞게 표시되지 않음

---

## 📋 역할별 상세 요구사항

---

## 👤 1. Admin (관리자)

### 권한
- **모든 기능을 관장**

### 필요한 기능
1. 회사 관리 (Owner, BP, EP 모두)
2. 사용자 관리 (모든 역할)
3. 장비 유형 관리
4. 인력 유형 관리
5. 점검표 템플릿 관리
6. 전체 시스템 모니터링
7. 전체 데이터 조회 및 관리

---

## 🏢 2. Owner (장비 임대 사업자)

### 대시보드 구성
- 보유 장비 현황
- 보유 인력 현황
- 반입 요청 현황 (대기/승인/반려)
- 투입 중인 장비/인력 현황
- 서류 만료 예정 알림
- 긴급 상황 알림

### 주요 기능

#### 2.1. 장비 관리
- 장비 등록/수정/삭제
- 장비별 서류 관리
- 장비별 정비 예정일 관리
- 장비별 가동 시간 관리

#### 2.2. 인력 관리
- 인력 등록/수정/삭제
- 인력별 서류 관리
- 운전자 자격 관리

#### 2.3. 서류 관리
- 장비 서류 업로드/조회/삭제
- 인력 서류 업로드/조회/삭제
- 서류 만료일 관리
- 만료 예정 알림

#### 2.4. 장비 점검 관리
- **운전자 일일 점검표 조회**
  - 목적: 차량 운행 시간, 가동 시간 체크
  - 목적: 장비별 정비 예정일 관리
  - 목적: 사고 방지
- 장비별 점검 이력 조회
- 점검표 양식은 장비 종류에 따라 자동 적용

#### 2.5. 반입 요청
- **반입 요청 생성**
  - BP 회사 선택
  - 장비 선택 (장비만 또는 장비+인력)
  - 인력 선택 (인력만 또는 장비+인력)
  - 서류 검증 (필수)
  - 투입 목적, 예정일 입력
  - **메일로도 전송** (현재 메일 시스템과 병행)

- **반입 요청 결과 확인**
  - 요청 상태 조회 (대기/승인/반려)
  - BP 승인 여부 확인
  - EP 최종 승인 여부 확인

#### 2.6. 반입 승인된 차량 관리 (투입 관리) ⭐ **핵심 기능**
- **투입 차량 목록 조회**
  - 현재 투입 중인 장비/인력 목록
  - 투입 시작일, 예정 반출일 표시
  
- **투입 상세 정보**
  - 장비 정보
  - 운전자 정보
  - 투입 기간 (시작일 ~ 예정 반출일)
  - 작업 현황
  - 작업 확인서 현황
  
- **투입 관리 기능**
  - **투입 기간 연장** (예정 반출일 변경)
  - **운전자 교체** (검증된 인력만 선택 가능)
    - 반입 심사에서 검증받은 인력만 교체 가능
  - 투입 종료 (반출 처리)

#### 2.7. 작업 확인서 관리 ⭐ **핵심 기능**

##### 일일 작업 확인서
- **운전자가 작성한 작업 확인서 조회**
  - 작업 시작/종료 시간 (자동 입력)
  - 휴식 시간 (자동 계산)
  - 초과 근무 시간 (자동 계산)
  - 운전자 확인 및 수정 가능
  
- **BP에게 서명 요청**
  - 작업 확인서 제출 (전자서명 요청)
  - 또는 메일로 제출
  
- **서명된 작업 확인서 저장**
  - BP 서명 완료 시 자동 저장
  - PDF 다운로드 가능

##### 월별 작업 확인서
- **월별 작업 확인서 자동 생성**
  - 일일 작업 확인서 자동 취합
  - 월별 총 작업 시간 계산
  - 월별 초과 근무 시간 계산
  
- **BP에게 월별 서명 요청**
  - 월별 작업 확인서 제출
  - 또는 메일로 제출
  
- **서명된 월별 작업 확인서 저장**
  - BP 서명 완료 시 자동 저장
  - PDF 다운로드 가능

#### 2.8. 실시간 위치 추적
- **투입 중인 장비/인력 위치 표시**
  - 지도에 장비 마커 표시
  - 지도에 운전자 마커 표시
  - 실시간 위치 업데이트

#### 2.9. 긴급 상황 알림
- 운전자가 전송한 긴급 알림 조회
- 긴급 상황 대응 및 해결 처리

#### 2.10. 사용자 등록
- 자사 운전자 등록
- 자사 관리자 등록

---

## 🏗️ 3. BP (시공사)

### 대시보드 구성
- 등록된 장비 임대 사업자 목록
- 반입 요청 대기 건수
- 투입 중인 장비/인력 현황
- 서명 대기 중인 작업 확인서 건수
- 서류 만료 예정 알림

### 주요 기능

#### 3.1. 장비 임대 사업자 등록 ⭐ **새로운 기능**
- **Owner 회사 등록**
  - 회사명, 사업자 번호, 연락처 등록
  - 담당자 정보 등록

#### 3.2. 반입 요청 관리
- **반입 요청 확인**
  - Owner가 요청한 반입 요청 목록 조회
  - 장비/인력 정보 확인
  - 서류 확인
  
- **반입 요청 서류 다운로드**
  - 장비 서류 다운로드
  - 인력 서류 다운로드
  - PDF로 저장 가능
  
- **장비 사용 계획서 첨부 및 EP 승인 요청**
  - 장비 사용 계획서 업로드
  - EP 회사 선택
  - EP에게 승인 요청 (메일 포함)

#### 3.3. 투입 장비 관리
- **투입 장비 목록 조회**
  - 현재 투입 중인 장비/인력 목록
  - 투입 시작일, 만료일 표시
  
- **투입 장비 상세 정보**
  - 장비 정보
  - 운전자 정보
  - 투입 기간
  - 작업 현황

#### 3.4. 일일 점검 일지 관리
- **운전자 일일 점검표 확인**
  - 운전자가 작성한 일일 점검표 조회
  - 점검 내용 확인
  
- **월별 점검 일지 확인**
  - 월별 점검 일지 자동 생성
  - 월별 점검 내역 조회

#### 3.5. 작업 확인서 서명 ⭐ **핵심 기능**
- **일일 작업 확인서 서명**
  - Owner/운전자가 제출한 작업 확인서 조회
  - 작업 내용 확인
  - 전자서명 (Canvas 기반)
  - 서명 완료 시 자동 저장 및 Owner에게 전송
  
- **월별 작업 확인서 서명**
  - 월별 작업 확인서 조회
  - 월별 작업 내용 확인
  - 전자서명
  - 서명 완료 시 자동 저장 및 Owner에게 전송

#### 3.6. 안전 점검표 확인
- **안전 점검원이 제출한 안전 점검 일지 확인**
  - EP가 요구하는 안전 점검 일지
  - 일일 안전 점검 내역 조회
  - 월별 안전 점검 내역 조회

#### 3.7. 실시간 위치 추적
- **투입 중인 장비/인력 위치 표시**
  - 지도에 장비 마커 표시
  - 지도에 운전자 마커 표시

#### 3.8. 긴급 상황 알림
- 운전자가 전송한 긴급 알림 조회
- 긴급 상황 대응

#### 3.9. 투입 장비 서류 만료 관리
- **투입 중인 장비/인력의 서류 만료일 확인**
  - 만료 예정 서류 알림
  - 서류 갱신 요청

---

## 🏛️ 4. EP (발주처)

### 대시보드 구성
- 등록된 BP 목록
- 반입 요청 대기 건수
- BP별 장비 임대 현황
- 서류 만료 예정 알림

### 주요 기능

#### 4.1. BP 등록 ⭐ **새로운 기능**
- **BP 회사 등록**
  - 회사명, 사업자 번호, 연락처 등록
  - 담당자 정보 등록

#### 4.2. 반입 요청 최종 승인
- **반입 요청 확인**
  - BP가 승인한 반입 요청 목록 조회
  - 장비 사용 계획서 확인
  
- **반입 요청 서류 다운로드**
  - 장비 서류 다운로드
  - 인력 서류 다운로드
  - 장비 사용 계획서 다운로드
  - **PDF로 저장 가능**
  
- **최종 승인 또는 반려**
  - 승인 시 Owner 및 BP에게 메일 전송
  - 반려 시 사유 입력 및 메일 전송

#### 4.3. BP별 장비 임대 현황 ⭐ **핵심 기능**
- **BP 목록 조회**
  - 등록된 BP 목록
  
- **BP별 투입 장비 현황**
  - BP 선택 시 해당 BP의 투입 장비 목록 표시
  
- **투입 장비 상세 정보**
  - **장비 임대 사업자 정보**
  - **장비 정보** (등록번호, 유형, 제조사 등)
  - **장비 운전자 정보** (이름, 연락처, 자격증 등)
  - **투입 기간** (시작일 ~ 예정 반출일)
  - **장비 서류 만료 내역**
  - **작업 확인서** (일일/월별)
  - **안전 점검표** (일일/월별)

#### 4.4. 실시간 위치 추적 ⭐ **핵심 기능**
- **전체 투입 장비/인력 위치 표시**
  - 지도에 BP사, 장비, 운전자 모두 표시
  
- **BP별 필터링**
  - BP 선택 시 해당 BP의 장비/인력만 표시
  
- **장비별 필터링**
  - 특정 장비 선택 시 해당 장비만 표시

#### 4.5. 서류 만료 관리
- **투입 중인 장비/인력의 서류 만료일 확인**
  - BP별 만료 예정 서류 알림
  - 서류 갱신 요청

---

## 📱 5. Worker (장비 운전자) - 모바일 앱

### 주요 기능

#### 5.1. 작업 시작/종료 ⭐ **핵심 기능**
- **작업 시작**
  - "작업 시작" 버튼 클릭
  - 시작 시간 자동 기록
  - GPS 위치 자동 전송 시작 (5분 간격)
  
- **휴식 시작/종료**
  - "휴식" 버튼 클릭 → "휴식 종료" 버튼으로 변경
  - 휴식 시간 자동 계산
  
- **작업 종료**
  - "작업 종료" 버튼 클릭
  - 종료 시간 자동 기록
  - GPS 위치 전송 중지
  - **작업 시간 자동 계산**
    - 총 작업 시간 = 종료 시간 - 시작 시간 - 휴식 시간
    - 초과 근무 시간 자동 계산 (8시간 초과 시)

#### 5.2. 작업 확인서 작성 및 제출 ⭐ **핵심 기능**
- **작업 확인서 자동 생성**
  - 작업 시작/종료 시간 자동 입력
  - 휴식 시간 자동 입력
  - 초과 근무 시간 자동 입력
  
- **운전자 확인 및 수정**
  - 자동 입력된 시간 확인
  - 필요 시 수정 가능
  
- **작업 확인서 제출**
  - Owner에게 제출
  - 또는 BP에게 직접 서명 요청
  - 또는 메일로 제출

#### 5.3. 장비 일일 점검표 작성 ⭐ **핵심 기능**
- **점검표 양식 자동 로드**
  - 장비 종류에 따라 점검표 양식 자동 적용
  
- **점검 항목 체크**
  - 차량 운행 시간 입력
  - 가동 시간 입력
  - 점검 항목 체크 (정상/이상)
  - 이상 발견 시 상세 내용 입력
  
- **본인 확인 후 제출**
  - 서명 또는 PIN 확인
  - Owner에게 자동 전송
  - 점검표는 장비별로 저장되어 이력 관리

#### 5.4. 긴급 상황 알림
- **긴급 상황 발생 버튼**
  - 긴급 유형 선택 (사고/고장/안전위험/기타)
  - 상세 설명 입력
  - GPS 위치 자동 포함하여 전송
  - Owner 및 BP에게 즉시 알림

#### 5.5. 모바일 UI 최적화 ⭐ **중요**
- **큰 버튼**
  - 작업 시작/종료 버튼 크게
  - 휴식 버튼 크게
  - 긴급 상황 버튼 크게 (빨간색)
  
- **간단한 입력**
  - 최소한의 입력만 요구
  - 자동 입력 최대화
  
- **명확한 상태 표시**
  - 현재 작업 상태 명확히 표시
  - 경과 시간 실시간 표시

---

## 🔍 6. Inspector (안전 점검원) - 모바일 앱

### 주요 기능

#### 6.1. 안전 점검 일지 작성
- **EP가 요구하는 안전 점검 일지 작성**
  - 점검 항목 체크
  - 안전 위험 요소 기록
  - 사진 첨부
  
- **BP 및 EP에게 제출**
  - 일일 안전 점검 일지 제출
  - BP 및 EP가 조회 가능

---

## 📊 데이터베이스 스키마 재설계 필요

### 추가 필요한 테이블

#### 1. companies (회사 정보) ⭐ **필수**
```sql
- id (PK)
- name (회사명)
- company_type (owner/bp/ep)
- business_number (사업자 번호)
- address (주소)
- phone (연락처)
- email (이메일)
- created_at
- updated_at
```

#### 2. deployments (투입 관리) ⭐ **필수**
```sql
- id (PK)
- entry_request_id (FK: entry_requests)
- equipment_id (FK: equipment)
- worker_id (FK: workers)
- start_date (투입 시작일)
- scheduled_end_date (예정 반출일)
- actual_end_date (실제 반출일)
- status (active/extended/completed)
- created_at
- updated_at
```

#### 3. work_confirmations (작업 확인서) ⭐ **필수**
```sql
- id (PK)
- deployment_id (FK: deployments)
- work_date (작업일)
- start_time (시작 시간)
- end_time (종료 시간)
- break_time (휴식 시간, 분)
- total_work_time (총 작업 시간, 분)
- overtime (초과 근무 시간, 분)
- worker_confirmed (운전자 확인 여부)
- worker_signature (운전자 서명)
- bp_confirmed (BP 확인 여부)
- bp_signature (BP 서명)
- bp_confirmed_at (BP 서명 일시)
- status (pending/confirmed/rejected)
- created_at
- updated_at
```

#### 4. monthly_work_confirmations (월별 작업 확인서) ⭐ **필수**
```sql
- id (PK)
- deployment_id (FK: deployments)
- year (년)
- month (월)
- total_work_days (총 작업일)
- total_work_time (총 작업 시간, 분)
- total_overtime (총 초과 근무 시간, 분)
- worker_confirmed (운전자 확인 여부)
- worker_signature (운전자 서명)
- bp_confirmed (BP 확인 여부)
- bp_signature (BP 서명)
- bp_confirmed_at (BP 서명 일시)
- status (pending/confirmed/rejected)
- created_at
- updated_at
```

#### 5. equipment_inspections (장비 일일 점검표) ⭐ **필수**
```sql
- id (PK)
- equipment_id (FK: equipment)
- worker_id (FK: workers)
- inspection_date (점검일)
- operation_hours (운행 시간)
- running_hours (가동 시간)
- checklist_data (점검 항목 JSON)
- issues (이상 내용)
- worker_signature (운전자 서명)
- created_at
```

#### 6. work_sessions (작업 세션) ⭐ **필수**
```sql
- id (PK)
- worker_id (FK: workers)
- equipment_id (FK: equipment)
- deployment_id (FK: deployments)
- work_date (작업일)
- start_time (시작 시간)
- end_time (종료 시간)
- status (working/break/completed)
- break_duration (휴식 시간, 분)
- total_work_minutes (총 작업 시간, 분)
- created_at
- updated_at
```

#### 7. location_logs (위치 기록) ⭐ **필수**
```sql
- id (PK)
- worker_id (FK: workers)
- equipment_id (FK: equipment)
- deployment_id (FK: deployments)
- latitude (위도)
- longitude (경도)
- accuracy (정확도)
- logged_at (기록 시간)
```

#### 8. emergency_alerts (긴급 알림) ⭐ **필수**
```sql
- id (PK)
- worker_id (FK: workers)
- equipment_id (FK: equipment)
- deployment_id (FK: deployments)
- alert_type (사고/고장/안전위험/기타)
- latitude (위도)
- longitude (경도)
- description (상세 설명)
- status (active/resolved/false_alarm)
- resolved_by (해결자 ID)
- resolution_note (해결 내용)
- resolved_at (해결 일시)
- created_at
```

#### 9. safety_inspections (안전 점검 일지) ⭐ **필수**
```sql
- id (PK)
- inspector_id (FK: users)
- bp_company_id (FK: companies)
- ep_company_id (FK: companies)
- inspection_date (점검일)
- checklist_data (점검 항목 JSON)
- safety_issues (안전 위험 요소)
- photos (사진 URL 배열)
- created_at
```

---

## 🎯 우선순위별 작업 계획

### Phase 1: 로그인 및 인증 시스템 수정 (최우선)
**예상 소요 시간**: 1일

1. 로그인 화면 수정
   - 비밀번호 입력 필수
   - 역할별 로그인 분리
   
2. 로그아웃 기능 수정
   - 로그아웃 버튼 작동하도록 수정
   - 세션 완전히 종료

3. 역할별 라우팅 가드
   - 역할에 맞지 않는 페이지 접근 차단

---

### Phase 2: 데이터베이스 스키마 재설계 (최우선)
**예상 소요 시간**: 1-2일

1. 누락된 테이블 생성
   - companies
   - deployments
   - work_confirmations
   - monthly_work_confirmations
   - equipment_inspections
   - work_sessions
   - location_logs
   - emergency_alerts
   - safety_inspections

2. Drizzle 스키마 파일 업데이트

3. 마이그레이션 실행

---

### Phase 3: 역할별 대시보드 재설계 (높음)
**예상 소요 시간**: 2-3일

1. Admin 대시보드
2. Owner 대시보드
3. BP 대시보드
4. EP 대시보드

---

### Phase 4: Owner 핵심 기능 구현 (높음)
**예상 소요 시간**: 3-4일

1. 투입 관리 (반입 승인된 차량 관리)
   - 투입 목록 조회
   - 투입 상세 정보
   - 투입 기간 연장
   - 운전자 교체

2. 작업 확인서 관리
   - 일일 작업 확인서
   - 월별 작업 확인서
   - 서명 요청 및 저장

3. 장비 점검 관리
   - 운전자 일일 점검표 조회
   - 장비별 점검 이력

---

### Phase 5: BP 핵심 기능 구현 (높음)
**예상 소요 시간**: 2-3일

1. Owner 등록 기능

2. 반입 요청 관리
   - 서류 다운로드 (PDF)
   - 장비 사용 계획서 첨부
   - EP 승인 요청

3. 작업 확인서 서명
   - 일일 작업 확인서 서명
   - 월별 작업 확인서 서명

4. 투입 장비 관리
   - 투입 장비 목록
   - 일일 점검 일지 확인
   - 안전 점검표 확인

---

### Phase 6: EP 핵심 기능 구현 (높음)
**예상 소요 시간**: 2-3일

1. BP 등록 기능

2. 반입 요청 최종 승인
   - 서류 다운로드 (PDF)

3. BP별 장비 임대 현황
   - BP별 투입 장비 목록
   - 투입 장비 상세 정보 (Owner, 장비, 운전자, 서류, 작업 확인서, 안전 점검표)

4. 실시간 위치 추적
   - BP별, 장비별 필터링

---

### Phase 7: Worker 모바일 앱 재설계 (높음)
**예상 소요 시간**: 2-3일

1. 작업 시작/종료 기능
   - 시간 자동 기록
   - 휴식 시간 자동 계산
   - 초과 근무 시간 자동 계산

2. 작업 확인서 작성 및 제출
   - 자동 생성
   - 확인 및 수정
   - 제출 (Owner/BP/메일)

3. 장비 일일 점검표 작성
   - 점검표 양식 자동 로드
   - 점검 항목 체크
   - 본인 확인 후 제출

4. 모바일 UI 최적화
   - 큰 버튼
   - 간단한 입력
   - 명확한 상태 표시

---

### Phase 8: 반입 요청 검증 수정 (높음)
**예상 소요 시간**: 1일

1. 반입 요청 검증 로직 수정
   - 서류 검증 로직 확인
   - 에러 메시지 명확히 표시

2. 메일 전송 기능 추가
   - 반입 요청 시 메일 전송
   - BP 승인 시 메일 전송
   - EP 승인 시 메일 전송

---

### Phase 9: PDF 다운로드 기능 추가 (중간)
**예상 소요 시간**: 1-2일

1. 서류 PDF 다운로드
2. 작업 확인서 PDF 다운로드
3. 안전 점검표 PDF 다운로드

---

### Phase 10: 테스트 및 버그 수정 (높음)
**예상 소요 시간**: 2-3일

1. 역할별 로그인 테스트
2. 각 기능 테스트
3. 버그 수정

---

## 📊 총 예상 소요 시간

| Phase | 작업 내용 | 예상 소요 시간 |
|-------|----------|--------------|
| Phase 1 | 로그인 및 인증 시스템 수정 | 1일 |
| Phase 2 | 데이터베이스 스키마 재설계 | 1-2일 |
| Phase 3 | 역할별 대시보드 재설계 | 2-3일 |
| Phase 4 | Owner 핵심 기능 구현 | 3-4일 |
| Phase 5 | BP 핵심 기능 구현 | 2-3일 |
| Phase 6 | EP 핵심 기능 구현 | 2-3일 |
| Phase 7 | Worker 모바일 앱 재설계 | 2-3일 |
| Phase 8 | 반입 요청 검증 수정 | 1일 |
| Phase 9 | PDF 다운로드 기능 추가 | 1-2일 |
| Phase 10 | 테스트 및 버그 수정 | 2-3일 |

**총 예상 소요 시간**: 약 17-27일 (약 3-5주)

---

## 📝 결론

현재 시스템은 실제 현장 업무 프로세스와 맞지 않아 전면적인 재설계가 필요합니다.

**핵심 문제**:
1. 로그인/로그아웃 시스템 오류
2. 투입 관리 기능 완전 미구현
3. 작업 확인서 기능 완전 미구현
4. 역할별 맞춤 대시보드 미구현
5. 데이터베이스 스키마 불완전

**핵심 기능**:
1. **투입 관리** (반입 승인 후 차량 관리)
2. **작업 확인서** (일일/월별, 서명 기능)
3. **장비 일일 점검표** (운전자 작성)
4. **역할별 회사 등록** (BP→Owner, EP→BP)
5. **BP별 장비 임대 현황** (EP용)

우선순위에 따라 단계별로 작업을 진행하는 것이 필요합니다.

---

**작성일**: 2025-10-26  
**작성자**: AI Assistant

